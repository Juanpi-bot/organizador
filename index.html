<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AudioLibro Pro - Pova Universal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        
        :root {
            --bg-deep: #020617;
            --accent: #6366f1;
            --glass: rgba(30, 41, 59, 0.5);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg-deep); 
            color: #f8fafc;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .glass { 
            background: var(--glass); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255,255,255,0.05); 
        }

        .highlight-word { 
            background: var(--accent); 
            color: white; 
            border-radius: 4px; 
            padding: 0 4px; 
            transition: all 0.1s; 
            border-bottom: 2px solid #fff; 
        }

        .active-tab { 
            color: var(--accent);
            background: rgba(99, 102, 241, 0.1);
        }
        
        input[type="range"] { accent-color: var(--accent); }

        #textContent:empty:before {
            content: attr(placeholder);
            color: #64748b;
            cursor: text;
            display: block; 
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        
        .reading-pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }

        .toast-notification {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%) translateY(-200%);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 999;
        }
        .toast-notification.show { transform: translateX(-50%) translateY(0); }

        /* Mobile specific adjustments */
        @media (max-width: 640px) {
            .nav-button {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
                font-size: 0.65rem;
            }
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- Toast Notification System -->
    <div id="toast" class="toast-notification glass text-white px-6 py-3 rounded-full shadow-2xl font-bold flex items-center gap-3">
        <i class="fas fa-check-circle text-indigo-400"></i>
        <span id="toastMessage">Texto guardado</span>
    </div>

    <!-- Header & Nav Refined -->
    <header class="glass sticky top-0 z-[100] border-b border-white/5 shadow-2xl">
        <div class="max-w-6xl mx-auto px-4 py-3 flex flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-2 flex-shrink-0">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-headphones-simple text-sm"></i>
                </div>
                <h1 class="font-bold text-base sm:text-lg tracking-tight hidden xs:block">AudioLibro <span class="text-indigo-400">Pro</span></h1>
            </div>
            
            <nav class="flex flex-1 max-w-[280px] bg-white/5 rounded-2xl p-1 gap-1">
                <button onclick="switchTab('reader')" id="tabReader" class="nav-button flex-1 py-2.5 rounded-xl font-bold text-[11px] sm:text-xs active-tab transition-all whitespace-nowrap flex items-center justify-center gap-2">
                    <i class="fas fa-play-circle"></i>LECTOR
                </button>
                <button onclick="switchTab('library')" id="tabLibrary" class="nav-button flex-1 py-2.5 rounded-xl font-bold text-[11px] sm:text-xs text-slate-400 hover:text-slate-200 transition-all whitespace-nowrap flex items-center justify-center gap-2">
                    <i class="fas fa-books"></i>BIBLIOTECA
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8">
        <div class="max-w-5xl mx-auto space-y-6 pb-24">
            
            <!-- Vista Lector -->
            <div id="viewReader" class="space-y-6 animate-in fade-in duration-300">
                <div class="glass rounded-[2rem] p-6 flex flex-col h-[40vh] sm:h-[50vh] relative shadow-inner">
                    <div id="textContent" 
                         contenteditable="true" 
                         class="flex-1 overflow-y-auto outline-none text-lg leading-relaxed text-slate-300 custom-scrollbar pr-2" 
                         placeholder="Welcome! Paste your story here. Emma (Natural) is the default English narrator. Your texts are saved safely in the library."></div>
                    <div class="absolute bottom-4 right-6 flex items-center gap-3 bg-slate-900/80 px-3 py-1.5 rounded-full border border-white/5">
                         <span id="wordCount" class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">0 palabras</span>
                         <button onclick="clearContent()" class="text-slate-400 hover:text-red-400 transition-colors" title="Limpiar todo"><i class="fas fa-eraser"></i></button>
                    </div>
                </div>

                <!-- Selector de Rango PDF -->
                <div id="pdfRangePanel" class="hidden glass rounded-[1.5rem] p-4 border border-indigo-500/20">
                    <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-file-pdf text-red-500 text-xl"></i>
                            <div>
                                <p class="text-xs font-bold text-white">Rango del Documento</p>
                                <p id="pdfInfoLabel" class="text-[10px] text-slate-500 uppercase">Detectando páginas...</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3 w-full sm:w-auto">
                            <input type="number" id="startPage" value="1" min="1" class="flex-1 sm:w-14 bg-slate-900 border border-white/10 rounded-xl p-2 text-xs text-center outline-none">
                            <span class="text-slate-500">a</span>
                            <input type="number" id="endPage" value="1" min="1" class="flex-1 sm:w-14 bg-slate-900 border border-white/10 rounded-xl p-2 text-xs text-center outline-none">
                            <button onclick="processPdfRange()" class="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-xl text-[10px] font-bold transition-all whitespace-nowrap">CARGAR</button>
                        </div>
                    </div>
                </div>

                <!-- Controles -->
                <div class="glass rounded-[2.5rem] p-6 sm:p-8 space-y-8 shadow-2xl">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-slate-500 ml-1 tracking-widest uppercase">Narrador Automático</label>
                            <select id="voiceSelect" onchange="warmUpVoice()" class="w-full bg-slate-900/50 p-4 rounded-2xl text-[11px] sm:text-xs outline-none border border-white/5 ring-1 ring-white/5 text-indigo-100"></select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-[10px] font-bold text-slate-500 ml-1 tracking-widest uppercase">Volumen</label>
                                <div class="flex items-center gap-3 bg-slate-900/50 p-4 rounded-2xl ring-1 ring-white/5 border border-white/5">
                                    <i class="fas fa-volume-low text-xs text-slate-500"></i>
                                    <input type="range" id="volumeRange" min="0" max="1" step="0.1" value="1" class="flex-1">
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-bold text-slate-500 ml-1 tracking-widest uppercase">Velocidad</label>
                                <div class="flex items-center gap-3 bg-slate-900/50 p-4 rounded-2xl ring-1 ring-white/5 border border-white/5">
                                    <input type="range" id="speedRange" min="0.5" max="2" step="0.1" value="1" class="flex-1">
                                    <span id="speedValue" class="text-xs font-bold text-indigo-400">1.0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row items-center gap-4">
                        <div class="flex items-center gap-3 w-full sm:w-auto">
                            <button id="exportBtn" onclick="exportTextAsFile()" title="Exportar TXT" class="w-14 h-14 rounded-full glass flex items-center justify-center text-indigo-400 hover:text-white transition-all shadow-lg border border-white/5 active:scale-95">
                                <i class="fas fa-file-export"></i>
                            </button>
                            <button id="saveBtn" onclick="saveCurrentToLibrary()" title="Guardar en Biblioteca" class="w-14 h-14 rounded-full glass flex items-center justify-center text-indigo-400 hover:text-white transition-all shadow-lg border border-white/5 active:scale-95">
                                <i class="fas fa-bookmark"></i>
                            </button>
                        </div>

                        <button id="playBtn" onclick="handlePlay()" class="w-full bg-indigo-600 hover:bg-indigo-500 py-5 rounded-[2rem] font-bold text-base sm:text-lg shadow-xl shadow-indigo-600/20 active:scale-95 transition-all flex items-center justify-center gap-4">
                            <i class="fas fa-play"></i> REPRODUCIR LIBRO
                        </button>
                        
                        <label class="w-full sm:w-auto flex-none bg-slate-800/50 hover:bg-slate-700/50 px-8 py-5 rounded-[2rem] text-xs font-bold text-slate-300 border border-white/5 cursor-pointer transition-all text-center">
                            <i class="fas fa-file-pdf mr-2"></i> PDF / TXT
                            <input type="file" id="fileInput" class="hidden" accept=".pdf,.txt">
                        </label>
                    </div>
                </div>
            </div>

            <!-- Vista Biblioteca -->
            <div id="viewLibrary" class="hidden space-y-6 animate-in slide-in-from-right duration-300">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-book-bookmark text-indigo-500"></i> Mis Cuentos
                </h2>
                <div id="libraryList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Dinámico -->
                </div>
            </div>
        </div>
    </main>

    <!-- Subtitles Overlay -->
    <div id="subtitleBar" class="fixed bottom-0 left-0 w-full p-6 sm:p-10 subtitle-bar transform translate-y-full transition-all duration-500 z-[110] backdrop-blur-2xl">
        <div class="max-w-4xl mx-auto space-y-6">
            <div id="subtitleText" class="text-center text-lg sm:text-3xl font-bold leading-tight text-white drop-shadow-xl"></div>
            
            <div class="flex justify-center items-center gap-10">
                <button onclick="skipSeconds(-10)" class="text-slate-400 hover:text-white transition-colors p-2"><i class="fas fa-backward-step text-2xl"></i></button>
                <button onclick="handlePlay()" id="miniPlayBtn" class="w-14 h-14 sm:w-16 sm:h-16 bg-white text-black rounded-full flex items-center justify-center shadow-2xl active:scale-90 transition-all">
                    <i class="fas fa-pause text-xl sm:text-2xl"></i>
                </button>
                <button onclick="skipSeconds(10)" class="text-slate-400 hover:text-white transition-colors p-2"><i class="fas fa-forward-step text-2xl"></i></button>
            </div>
        </div>
    </div>

    <audio id="silentAudio" loop src="data:audio/wav;base64,UklGRigAAABXQVZFlm10IBAAAAABAAEARKwAAIhAAQACABAAZGF0YQQAAAAAAA=="></audio>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-id';

        let user = null;
        let libraryData = [];

        signInAnonymously(auth);
        onAuthStateChanged(auth, (u) => {
            user = u;
            if (user) loadLibrary();
        });

        function loadLibrary() {
            const q = collection(db, 'artifacts', appId, 'users', user.uid, 'library');
            onSnapshot(q, (snapshot) => {
                libraryData = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                renderLibrary();
            }, (err) => console.error(err));
        }

        window.saveCurrentToLibrary = async () => {
            const text = document.getElementById('textContent').innerText.trim();
            if (!text || !user) return showToast("Sin texto para guardar", true);
            
            const title = text.substring(0, 50).replace(/\n/g, " ") + "...";
            try {
                await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'library'), {
                    title, text, date: new Date().toISOString()
                });
                showToast("¡Guardado en biblioteca!");
            } catch (e) {
                showToast("Error al guardar", true);
            }
        };

        window.deleteFromLibrary = async (id) => {
            await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'library', id));
            showToast("Libro eliminado");
        };

        function renderLibrary() {
            const list = document.getElementById('libraryList');
            if (libraryData.length === 0) {
                list.innerHTML = `<div class="col-span-full p-12 text-center text-slate-600 italic">No hay libros guardados todavía.</div>`;
                return;
            }
            list.innerHTML = libraryData.map(item => `
                <div class="glass p-6 rounded-[2rem] flex justify-between items-center gap-4 group hover:border-indigo-500/30 transition-all">
                    <div class="flex-1 cursor-pointer overflow-hidden" onclick="loadToReader('${item.id}')">
                        <h4 class="font-bold text-slate-100 text-sm sm:text-base truncate">${item.title}</h4>
                        <p class="text-[10px] text-indigo-400 font-bold uppercase mt-1">
                            <i class="far fa-calendar-alt mr-1"></i> ${new Date(item.date).toLocaleDateString()}
                        </p>
                    </div>
                    <button onclick="deleteFromLibrary('${item.id}')" class="text-slate-600 hover:text-red-400 p-2">
                        <i class="fas fa-trash-can"></i>
                    </button>
                </div>
            `).join('');
        }

        window.loadToReader = (id) => {
            const item = libraryData.find(d => d.id === id);
            document.getElementById('textContent').innerText = item.text;
            switchTab('reader');
            updateWordCount();
            showToast("Cargado");
        };

        window.showToast = (msg, isError = false) => {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').innerText = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        };
    </script>

    <script>
        const synth = window.speechSynthesis;
        const voiceSelect = document.getElementById('voiceSelect');
        const textContent = document.getElementById('textContent');
        const speedRange = document.getElementById('speedRange');
        const speedValue = document.getElementById('speedValue');
        const volumeRange = document.getElementById('volumeRange');
        const subtitleBar = document.getElementById('subtitleBar');
        const subtitleText = document.getElementById('subtitleText');
        const playBtn = document.getElementById('playBtn');
        const miniPlayBtn = document.getElementById('miniPlayBtn');
        const silentAudio = document.getElementById('silentAudio');

        let voices = [];
        let currentUtterance = null;
        let lastCharIndex = 0;
        let currentPdf = null;

        function initVoices() {
            voices = synth.getVoices();
            if (voices.length === 0) return;

            voiceSelect.innerHTML = '';
            const sorted = voices.sort((a, b) => {
                if (a.name.includes('Emma')) return -1;
                if (a.name.includes('Natural') && !b.name.includes('Natural')) return -1;
                return 0;
            });

            sorted.forEach(v => {
                const opt = document.createElement('option');
                opt.value = v.name;
                opt.textContent = v.name.replace('Microsoft ', '').replace('Online (Natural)', 'Natural ✨');
                voiceSelect.appendChild(opt);
                if (v.name.includes('Emma')) opt.selected = true;
            });
            warmUpVoice();
        }

        function warmUpVoice() {
            synth.cancel();
            const wu = new SpeechSynthesisUtterance("");
            const s = voices.find(v => v.name === voiceSelect.value);
            if (s) wu.voice = s;
            wu.volume = 0;
            synth.speak(wu);
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = initVoices;
        }
        initVoices();

        function handlePlay() {
            if (synth.speaking) {
                if (synth.paused) {
                    synth.resume();
                    updateUI(true);
                } else {
                    synth.pause();
                    updateUI(false);
                }
                return;
            }
            const txt = textContent.innerText.trim();
            if (txt) startSpeaking(txt, 0);
        }

        function startSpeaking(text, fromIndex) {
            synth.cancel();
            silentAudio.play().catch(()=>{});

            const remaining = text.substring(fromIndex);
            currentUtterance = new SpeechSynthesisUtterance(remaining);
            const v = voices.find(vo => vo.name === voiceSelect.value);
            if (v) currentUtterance.voice = v;
            
            currentUtterance.rate = parseFloat(speedRange.value);
            currentUtterance.volume = parseFloat(volumeRange.value);

            currentUtterance.onboundary = (e) => {
                if (e.name === 'word') {
                    const idx = fromIndex + e.charIndex;
                    lastCharIndex = idx;
                    updateSubtitles(text, idx);
                }
            };

            currentUtterance.onend = () => { if(!synth.paused) stopPlayback(); };
            
            subtitleBar.classList.remove('translate-y-full');
            updateUI(true);
            
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: 'Lector AudioLibro',
                    artist: voiceSelect.value,
                    album: 'Pova Pro'
                });
                navigator.mediaSession.setActionHandler('play', () => { synth.resume(); updateUI(true); });
                navigator.mediaSession.setActionHandler('pause', () => { synth.pause(); updateUI(false); });
            }

            synth.speak(currentUtterance);
        }

        function stopPlayback() {
            synth.cancel();
            subtitleBar.classList.add('translate-y-full');
            updateUI(false);
            textContent.innerHTML = textContent.innerText;
            silentAudio.pause();
        }

        function updateUI(playing) {
            playBtn.innerHTML = playing ? '<i class="fas fa-pause mr-2"></i> PAUSAR' : '<i class="fas fa-play mr-2"></i> REPRODUCIR LIBRO';
            playBtn.className = playing 
                ? "w-full bg-amber-500 py-5 rounded-[2rem] font-bold text-base sm:text-lg shadow-xl reading-pulse flex items-center justify-center gap-4 transition-all"
                : "w-full bg-indigo-600 py-5 rounded-[2rem] font-bold text-base sm:text-lg shadow-xl flex items-center justify-center gap-4 transition-all";
            miniPlayBtn.innerHTML = playing ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play ml-1"></i>';
        }

        function updateSubtitles(fullText, index) {
            const context = 70;
            let start = Math.max(0, index - context / 2);
            let end = Math.min(fullText.length, index + context / 2);
            while (start > 0 && fullText[start] !== ' ') start--;
            while (end < fullText.length && fullText[end] !== ' ') end++;
            
            const phrase = fullText.substring(start, end);
            const relIdx = index - start;
            let wordEnd = phrase.indexOf(' ', relIdx);
            if (wordEnd === -1) wordEnd = phrase.length;
            
            const b = phrase.substring(0, relIdx);
            const w = phrase.substring(relIdx, wordEnd);
            const a = phrase.substring(wordEnd);
            
            subtitleText.innerHTML = `<span class="opacity-30">${b}</span> <span class="text-indigo-400 underline decoration-4 underline-offset-8">${w}</span> <span class="opacity-30">${a}</span>`;
            
            const mainB = fullText.substring(0, index);
            const mainW = fullText.substring(index, index + w.length);
            const mainA = fullText.substring(index + w.length);
            textContent.innerHTML = `${mainB}<span class="highlight-word">${mainW}</span>${mainA}`;
            
            const h = textContent.querySelector('.highlight-word');
            if (h) h.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function exportTextAsFile() {
            const t = textContent.innerText.trim();
            if (!t) return;
            const b = new Blob([t], { type: 'text/plain' });
            const u = URL.createObjectURL(b);
            const a = document.createElement('a');
            a.href = u;
            a.download = `libro_pova_${Date.now()}.txt`;
            a.click();
        }

        async function processPdfRange() {
            if (!currentPdf) return;
            const s = parseInt(document.getElementById('startPage').value);
            const e = parseInt(document.getElementById('endPage').value);
            if (s < 1 || e > currentPdf.numPages || s > e) return;
            
            textContent.innerText = "Leyendo páginas seleccionadas...";
            let t = "";
            for (let i = s; i <= e; i++) {
                const p = await currentPdf.getPage(i);
                const c = await p.getTextContent();
                t += c.items.map(it => it.str).join(" ") + " ";
            }
            textContent.innerText = t.replace(/\s+/g, ' ').trim();
            updateWordCount();
        }

        function clearContent() {
            textContent.innerText = "";
            updateWordCount();
        }

        function skipSeconds(sec) {
            const step = sec * 15 * parseFloat(speedRange.value);
            const ni = Math.max(0, lastCharIndex + step);
            startSpeaking(textContent.innerText, Math.floor(ni));
        }

        function updateWordCount() {
            const t = textContent.innerText.trim();
            document.getElementById('wordCount').textContent = (t ? t.split(/\s+/).length : 0) + " palabras";
        }

        function switchTab(tab) {
            const reader = document.getElementById('viewReader');
            const library = document.getElementById('viewLibrary');
            const tabR = document.getElementById('tabReader');
            const tabL = document.getElementById('tabLibrary');

            if (tab === 'reader') {
                reader.classList.remove('hidden');
                library.classList.add('hidden');
                tabR.className = "nav-button flex-1 py-2.5 rounded-xl font-bold text-[11px] sm:text-xs active-tab transition-all whitespace-nowrap flex items-center justify-center gap-2";
                tabL.className = "nav-button flex-1 py-2.5 rounded-xl font-bold text-[11px] sm:text-xs text-slate-400 hover:text-slate-200 transition-all whitespace-nowrap flex items-center justify-center gap-2";
            } else {
                reader.classList.add('hidden');
                library.classList.remove('hidden');
                tabR.className = "nav-button flex-1 py-2.5 rounded-xl font-bold text-[11px] sm:text-xs text-slate-400 hover:text-slate-200 transition-all whitespace-nowrap flex items-center justify-center gap-2";
                tabL.className = "nav-button flex-1 py-2.5 rounded-xl font-bold text-[11px] sm:text-xs active-tab transition-all whitespace-nowrap flex items-center justify-center gap-2";
            }
        }

        textContent.addEventListener('input', updateWordCount);
        speedRange.oninput = () => speedValue.textContent = speedRange.value;

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const f = e.target.files[0];
            if (!f) return;
            if (f.type === "application/pdf") {
                const ab = await f.arrayBuffer();
                currentPdf = await pdfjsLib.getDocument(ab).promise;
                document.getElementById('pdfRangePanel').classList.remove('hidden');
                document.getElementById('pdfInfoLabel').textContent = `${currentPdf.numPages} páginas totales`;
                document.getElementById('startPage').value = 1;
                document.getElementById('endPage').value = currentPdf.numPages;
                processPdfRange();
            } else {
                const r = new FileReader();
                r.onload = (ev) => {
                    textContent.innerText = ev.target.result;
                    document.getElementById('pdfRangePanel').classList.add('hidden');
                    updateWordCount();
                };
                r.readAsText(f);
            }
        });
    </script>
</body>
</html>